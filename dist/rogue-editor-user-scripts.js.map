{"version":3,"file":"rogue-editor-user-scripts.js","mappings":"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","sources":["webpack://[name]/webpack/universalModuleDefinition","webpack://[name]/./Assets/rogue_packages/rogue-cannon/Components/_Editor/CannonBodyWireframe.ts"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"rogue-editor-user-scripts\"] = factory();\n\telse\n\t\troot[\"rogue-editor-user-scripts\"] = factory();\n})(self, function() {\nreturn ","import * as RE from 'rogue-engine';\nimport * as THREE from 'three';\n\nimport CannonBox from '../Shapes/CannonBox.re';\nimport CannonSphere from '../Shapes/CannonSphere.re';\nimport CannonShape from '../Shapes/CannonShape';\nimport CannonCylinder from '../Shapes/CannonCylinder.re';\nimport CannonTrimesh from '../Shapes/CannonTrimesh.re';\n\nexport default class CannonBodyWireframe extends RE.Component {\n  static isEditorComponent = true;\n\n  selectedObjects: THREE.Object3D[] = [];\n  colliders: THREE.Object3D[] = [];\n  wireframeMaterial = new THREE.MeshStandardMaterial({wireframe: true, emissive: new THREE.Color(\"#00FF00\"), color: new THREE.Color(\"#000000\")});\n\n  private handleOnComponentAdded = {stop: () => {}};\n  private handleOnComponentRemoved = {stop: () => {}};\n\n  private handleOnPlay = {stop: () => {}};\n\n  private resetHandler = (component: RE.Component) => {\n    component instanceof CannonShape && this.setupImpostors();\n  }\n\n  start() {\n    this.handleOnComponentAdded.stop();\n    this.handleOnComponentRemoved.stop();\n    this.handleOnPlay.stop();\n\n    this.handleOnComponentAdded = RE.onComponentAdded(this.resetHandler);\n    this.handleOnComponentRemoved = RE.onComponentRemoved(this.resetHandler);\n\n    this.handleOnPlay = RE.Runtime.onPlay(() => {\n      this.handleOnComponentAdded.stop();\n      this.handleOnComponentRemoved.stop();\n      this.cleanupImpostors();\n    });\n  }\n\n  afterUpdate() {\n    const selectedObjects = window[\"rogue-editor\"].Project.selectedObjects as THREE.Object3D[];\n\n    if (!this.arraysAreEqual(selectedObjects, this.selectedObjects)) {\n      this.selectedObjects = selectedObjects.slice(0);\n      this.setupImpostors();\n    }\n\n    if (this.selectedObjects.length === 0) return;\n\n    this.updateImpostors();\n  }\n\n  private updateImpostors() {\n    this.colliders.forEach(impostor => {\n      this.updateColliderMesh(impostor.userData.cannonShape, impostor as THREE.Mesh);\n    });\n  }\n\n  private cleanupImpostors() {\n    this.colliders.forEach(impostor => {\n      impostor.userData.cannonShape = null;\n      RE.App.currentScene.remove(impostor);\n      RE.dispose(impostor);\n    });\n\n    this.colliders = [];\n  }\n\n  private setupImpostors() {\n    this.cleanupImpostors();\n\n    this.selectedObjects.forEach(selected => {\n      selected.traverse(object => {\n        const objComponents = RE.components[object.uuid];\n\n        if (!objComponents) return;\n\n        objComponents.forEach(component => {\n          if (!(component instanceof CannonShape)) return;\n\n          let impostor = RE.App.currentScene.getObjectByName(\"EDITOR_OBJECT_BB_\" + object.uuid);\n\n          if (impostor) return;\n\n          impostor = this.getColliderMesh(component);\n\n          if (impostor) {\n            impostor.name = \"EDITOR_OBJECT_BB_\" + object.uuid;\n            impostor.userData.isEditorObject = true;\n            RE.App.currentScene.add(impostor);\n          } else {\n            return;\n          }\n\n          impostor.userData.cannonShape = component;\n          this.colliders.push(impostor);\n        });\n      });\n    });\n  }\n\n  private arraysAreEqual(array1: any[], array2: any[]) {\n    if (array1.length !== array2.length) return false;\n\n    return array1.every((element, i) => {\n      return array2[i] === element;\n    });\n  }\n\n  private getColliderMesh(component: CannonShape): THREE.Mesh | undefined {\n    if (component instanceof CannonBox) {\n      return new THREE.Mesh(\n        new THREE.BoxBufferGeometry(),\n        this.wireframeMaterial,\n      );\n    }\n\n    if (component instanceof CannonCylinder) {\n      const radiusTop = component.radiusTopOffset;\n      const radiusBottom = component.radiusBottomOffset;\n      const height = component.heightOffset;\n      const mesh = new THREE.Mesh(\n        new THREE.CylinderBufferGeometry(radiusTop, radiusBottom, height, component.segments),\n        this.wireframeMaterial,\n      );\n\n      return mesh;\n    }\n\n    if (component instanceof CannonSphere) {\n      const scale = component.object3d.scale;\n      const maxSide = Math.max(scale.x, scale.y, scale.z);\n\n      const radius = component.radiusOffset * (maxSide);\n      const compensatedRadius = radius + (radius * 0.01);\n      const segments = 15;\n\n      return new THREE.Mesh(\n        new THREE.SphereBufferGeometry(compensatedRadius, segments, segments),\n        this.wireframeMaterial,\n      );\n    }\n\n    if (component instanceof CannonTrimesh) {\n\n      if (!component.shape) component.createShape();\n\n      if (component.shape) {\n        const geometry = new THREE.BufferGeometry();\n        const mesh = new THREE.Mesh(geometry, this.wireframeMaterial);\n\n        const points: THREE.Vector3[] = [];\n\n        for (let i = 0; i < component.shape.vertices.length; i+=3) {\n          const point = new THREE.Vector3(\n            component.shape.vertices[i],\n            component.shape.vertices[i + 1],\n            component.shape.vertices[i + 2]\n          );\n\n          points.push(point);\n        }\n\n        geometry.setFromPoints(points);\n\n        return mesh;\n      }\n    }\n\n    return;\n  }\n\n  private updateColliderMesh(component: CannonShape, mesh: THREE.Mesh) {\n    if (component instanceof CannonBox) {\n      component.object3d.getWorldScale(mesh.scale);\n\n      mesh.scale.set(\n        component.sizeOffset.x * (mesh.scale.x),\n        component.sizeOffset.y * (mesh.scale.y),\n        component.sizeOffset.z * (mesh.scale.z)\n      );\n    }\n\n    if (component instanceof CannonCylinder) {\n      const radiusTop = component.radiusTopOffset;\n      const radiusBottom = component.radiusBottomOffset;\n      const height = component.heightOffset;\n\n      if (mesh.geometry instanceof THREE.CylinderBufferGeometry) {\n        if (\n          mesh.geometry.parameters.radiusTop !== radiusTop ||\n          mesh.geometry.parameters.radiusBottom !== radiusBottom ||\n          mesh.geometry.parameters.height !== height ||\n          mesh.geometry.parameters.radialSegments !== component.segments\n        ) {\n          mesh.geometry.dispose();\n          mesh.geometry = new THREE.CylinderBufferGeometry(radiusTop, radiusBottom, height, component.segments);\n        }\n      }\n      component.object3d.getWorldScale(mesh.scale);\n    }\n\n    if (component instanceof CannonSphere) {\n      const scale = component.object3d.scale;\n      const maxSide = Math.max(scale.x, scale.y, scale.z);\n\n      const radius = component.radiusOffset * (maxSide);\n\n      if (mesh.geometry instanceof THREE.SphereBufferGeometry) {\n        if (mesh.geometry.parameters.radius !== radius) {\n          let segments = 10 * radius;\n\n          if (segments < 15) segments = 15;\n\n          if (segments > 50) segments = 50;\n\n          mesh.geometry.dispose();\n          mesh.geometry = new THREE.SphereBufferGeometry(radius, segments, segments);\n        }\n      }\n    }\n\n    component.object3d.getWorldPosition(mesh.position);\n    component.object3d.getWorldQuaternion(mesh.quaternion);\n    // component.object3d.getWorldScale(mesh.scale);\n  }\n\n  onBeforeRemoved() {\n    this.handleOnComponentAdded.stop();\n    this.handleOnComponentRemoved.stop();\n    this.handleOnPlay.stop();\n    this.cleanupImpostors();\n  }\n}\n\nRE.registerComponent(CannonBodyWireframe);\n"],"names":[],"sourceRoot":""}